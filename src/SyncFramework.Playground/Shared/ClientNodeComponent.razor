@inject ISnackbar Snackbar

@if (this.item.IsLoading)
{
    <MudCard>
        <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="200px" />
        <MudCardContent>
            <MudSkeleton Width="30%" Height="42px;" />
            <MudSkeleton Width="80%" />
            <MudSkeleton Width="100%" />
        </MudCardContent>
        <MudCardActions>
            <MudSkeleton Width="64px" Height="40px" Class="ml-2" />
            <MudSkeleton Width="105px" Height="40px" Class="ml-3" />
        </MudCardActions>
    </MudCard>
}
else
{
    <MudCard>
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h5" Align="Align.Left" Color="Color.Primary">CLIENT ID:@item.Id</MudText>
            </CardHeaderContent>
            <CardHeaderActions>
                <MudIconButton Icon="@Icons.Material.Filled.LaptopMac" Color="@Color" />
            </CardHeaderActions>
        </MudCardHeader>
        <MudCardContent>
            <MudText Typo="Typo.h6" Align="Align.Left" Color="Color.Warning">DELTA COUNT: @item.DeltaCount</MudText>

            <MudPaper Class="pa-2 my-4 d-flex gap-2 flex-wrap">
                <MudButton StartIcon="@Icons.Material.Filled.Refresh" Color="Color.Success" OnClick="@(() => item.ReloadData())">Reload Data</MudButton>
                <MudButton StartIcon="@Icons.Material.Filled.ArrowUpward" Color="Color.Primary" OnClick="@(() => item.Push())">Push Deltas</MudButton>
                <MudButton StartIcon="@Icons.Material.Filled.ArrowDownward" Color="Color.Tertiary" OnClick="@(() => item.Pull())">Pull Deltas</MudButton>
                <MudButton StartIcon="@Icons.Material.Filled.DeleteForever" Color="Color.Error" OnClick="@(() => item.PurgeDeltas())">Purge Deltas</MudButton>
                <MudButton StartIcon="@Icons.Material.Filled.SaveAlt" Color="Color.Info" OnClick="@(() => item.DownloadFile())">Download Databases</MudButton>
            </MudPaper>

            <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-4">
                <MudTabPanel Text="Contacts & Phones">
                    @if (item.SelectedPerson != null)
                    {
                        <MudAlert Severity="Severity.Info" Class="mb-4" ShowCloseIcon="true" CloseIconClicked="() => item.SelectedPerson = null">
                            Selected Contact: @item.SelectedPerson.FirstName @item.SelectedPerson.LastName
                        </MudAlert>
                    }

                    <MudStack Row="true" Spacing="4">
                        <MudPaper Class="flex-1" Elevation="0">
                            <MudDataGrid Virtualize="true" FixedHeader="true" Height="350px" Items="@item.People" @bind-SelectedItem="@item.SelectedPerson" Hover="true" Striped="true" Dense="true" MultiSelection="false">
                                <ToolBarContent>
                                    <MudText Typo="Typo.h6">Contacts</MudText>
                                    <MudSpacer />
                                    <MudIconButton Icon="@Icons.Material.Filled.Add" Color="Color.Primary" OnClick="AddPerson" />
                                </ToolBarContent>
                                <Columns>
                                    <SelectColumn />
                                    <PropertyColumn Property="x => x.FirstName" Title="Name" />
                                    <PropertyColumn Property="x => x.LastName" Title="Lastname" />
                                    <TemplateColumn CellClass="d-flex justify-end">
                                        <CellTemplate>
                                            <MudStack Row>
                                                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Edit" Color="Color.Success" OnClick="@(() => EditPerson(context.Item))"></MudIconButton>
                                                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="@(() => RemovePerson(context.Item))"></MudIconButton>
                                            </MudStack>
                                        </CellTemplate>
                                    </TemplateColumn>
                                </Columns>
                            </MudDataGrid>
                        </MudPaper>

                        <MudPaper Class="flex-1" Elevation="0">
                            <MudDataGrid Virtualize="true" FixedHeader="true" Height="350px" Items="@item.PhoneNumbers" Hover="true" Striped="true" Dense="true" MultiSelection="false">
                                <ToolBarContent>
                                    <MudText Typo="Typo.h6">Phones</MudText>
                                    <MudSpacer />
                                    <MudIconButton Icon="@Icons.Material.Filled.Add" Color="Color.Primary" OnClick="AddPhone" />
                                </ToolBarContent>
                                <Columns>
                                    <SelectColumn />
                                    <PropertyColumn Property="x => x.Number" Title="Number" />
                                    <TemplateColumn CellClass="d-flex justify-end">
                                        <CellTemplate>
                                            <MudStack Row>
                                                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Edit" Color="Color.Success" OnClick="@(() => EditPhone(context.Item))"></MudIconButton>
                                                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="@(() => RemovePhoneNumber(context.Item))"></MudIconButton>
                                            </MudStack>
                                        </CellTemplate>
                                    </TemplateColumn>
                                </Columns>
                            </MudDataGrid>
                        </MudPaper>
                    </MudStack>
                </MudTabPanel>

                <MudTabPanel Text="Deltas">
                    <MudDataGrid Virtualize="true" FixedHeader="true" Height="400px" Items="@item.Deltas" Hover="true" Striped="true" Dense="true" MultiSelection="false">
                        <ToolBarContent>
                            <MudText Typo="Typo.h6">Synchronization Deltas</MudText>
                            <MudSpacer />
                        </ToolBarContent>
                        <Columns>
                            <SelectColumn />
                            <PropertyColumn Property="x => x.Key.Epoch" Title="Epoch" />
                            <PropertyColumn Property="x => x.Key.Date" Title="Date" />
                            <PropertyColumn Property="x => x.Key.Index" Title="Index" />
                            <TemplateColumn CellClass="d-flex justify-end">
                                <CellTemplate>
                                    <MudStack Row>
                                        <MudTooltip Text="Preview">
                                            <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Preview" Color="Color.Success" OnClick="@(() => PreviewDelta(context.Item.Value))"></MudIconButton>
                                        </MudTooltip>
                                        <MudTooltip Text="Download">
                                            <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Download" Color="Color.Primary" OnClick="@(() => DownloadDelta(context.Item))"></MudIconButton>
                                        </MudTooltip>
                                    </MudStack>
                                </CellTemplate>
                            </TemplateColumn>
                        </Columns>
                    </MudDataGrid>
                </MudTabPanel>
            </MudTabs>
        </MudCardContent>
    </MudCard>
}

@code {

}