@page "/"
@using SyncFramework.Playground.EfCore;
@using MudBlazor;
@inject ISnackbar Snackbar

<PageTitle>EfCore Demo</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudCard Elevation="3" Class="mb-4">
        <MudCardHeader>
            <MudText Typo="Typo.h4">SyncFramework: A Demonstration</MudText>
        </MudCardHeader>
        <MudCardContent>
            <MudText Typo="Typo.body1">
                A professional demonstration of the <MudLink Underline="Underline.Always" Target="_blank" Href="https://github.com/egarim/SyncFramework">SyncFramework</MudLink>
                for Entity Framework Core, developed by <MudLink Target="_blank" Underline="Underline.Always" Href="https://www.jocheojeda.com">Joche Ojeda</MudLink>,
                CTO at <MudLink Underline="Underline.Always" Target="_blank" Href="https://www.xari.io">XARI</MudLink> and
                <MudLink Underline="Underline.Always" Target="_blank" Href="https://www.bitframeworks.com">BIT Frameworks</MudLink>.
            </MudText>
            <MudText Typo="Typo.body2" Class="mt-2">
                All required NuGet packages are available at <MudLink Target="_blank" Underline="Underline.Always" Href="https://www.nuget.org/packages?q=%09BIT.Data.Sync">Nuget.org</MudLink>.
                View our <MudLink Target="_blank" Underline="Underline.Always" Href="https://youtu.be/JqjGvcbIUzQ">video tutorial</MudLink> where
                <MudLink Target="_blank" Underline="Underline.Always" Href="https://xafmarin.com">Javier</MudLink> and
                <MudLink Target="_blank" Underline="Underline.Always" Href="https://www.jocheojeda.com">I</MudLink> explain the SyncFramework playground.
            </MudText>
        </MudCardContent>
    </MudCard>

    <MudPaper Elevation="3" Class="pa-4 mb-4">
        <MudText Typo="Typo.h5" Class="mb-3">Server Configuration</MudText>
        <SyncServerComponent DeltaStore="@ServerDeltaStore" NodeId="@NodeId" @ref="@serverComponent" />

        <MudDivider Class="my-4" />

        <MudExpansionPanel>
            <TitleContent>
                <MudText Typo="Typo.h6">Client Node Options</MudText>
            </TitleContent>
            <ChildContent>
                <MudGrid>
                    <MudItem xs="12" sm="6">
                        <MudCard Elevation="0" Class="pa-2">
                            <MudCardContent>
                                <MudButton StartIcon="@Icons.Material.Filled.Add"
                                           Color="Color.Primary"
                                           OnClick="AddClientNode"
                                           Size="Size.Small">Add client node</MudButton>
                                <MudCheckBox T="bool"
                                             Dense="true"
                                             Label="Generate Random Data"
                                             @bind-Checked="@GenerateRandomData" />
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudCard Elevation="0" Class="pa-2">
                            <MudCardContent>
                                <MudButton StartIcon="@Icons.Material.Filled.FileDownload"
                                           Color="Color.Primary"
                                           OnClick="DownloadAllDatabases"
                                           Size="Size.Small">Download all databases</MudButton>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                </MudGrid>

                <MudText Typo="Typo.subtitle2" Class="mt-3">Additional delta generators:</MudText>
                <MudText Typo="Typo.caption" Class="mb-2">Check to generate deltas compatible with other databases</MudText>
                <MudPaper Elevation="0" Class="pa-2 d-flex gap-4">
                    <MudCheckBox T="bool" Label="Postgres" Dense="true" @bind-Checked="@Postgres" />
                    <MudCheckBox T="bool" Label="MySql" Dense="true" @bind-Checked="@MySql" />
                    <MudCheckBox T="bool" Label="SqlServer" Dense="true" @bind-Checked="@SqlServer" />
                </MudPaper>
            </ChildContent>
        </MudExpansionPanel>
    </MudPaper>

    <MudText Typo="Typo.h5" Class="mb-3">Nodes</MudText>
    <MudPaper Elevation="2" Class="pa-4">
        <MudTabs>
            <MudTabPanel Text="Server">
                <SyncServerComponent DeltaStore="@ServerDeltaStore" NodeId="@NodeId" @ref="@serverComponent" />
            </MudTabPanel>
            @if (ClientNodes.Any())
            {
                @foreach (var item in ClientNodes)
                {
                    <MudTabPanel Text="@item.Id">
                        <ClientNodeComponent item="@item"></ClientNodeComponent>
                    </MudTabPanel>
                }
            }
            else
            {
                <MudTabPanel Text="No Clients">
                    <MudAlert Severity="Severity.Info">No client nodes added yet. Click "Add client node" to begin.</MudAlert>
                </MudTabPanel>
            }
        </MudTabs>
    </MudPaper>
</MudContainer>

<MudScrollToTop>
    <MudFab Color="Color.Tertiary" Size="Size.Small" Icon="@Icons.Material.Filled.ArrowCircleUp" />
</MudScrollToTop>