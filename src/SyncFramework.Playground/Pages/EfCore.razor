@page "/"
@using SyncFramework.Playground.EfCore;
@using MudBlazor;

<PageTitle>EfCore Demo</PageTitle>

<h1>Server</h1>

<SyncServerComponent deltaStore="@ServerDeltaStore" NodeId="@NodeId" @ref="@serverComponent" />


<MudStack Row="true">
    <MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="AddClientNode">Add client node</MudButton>
    <MudCheckBox Label="Generate Random Data" @bind-Checked="@GenerateRandomData" />
    <MudElement>Deltas:@this.DeltaCount</MudElement>
</MudStack>


<MudStack>
    @foreach (var item in this.ClientNodes)
    {
        
        <MudCard>
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">@item.Id</MudText>
                </CardHeaderContent>
                <CardHeaderActions>
                    <MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Default" />
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent>
                <MudText>Delta count @item.DeltaCount</MudText>
                <MudForm>
                    <MudTextField @bind-Value="@item.PersonName" Label="Blog Name" />
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" DisableElevation="true" OnClick="@(()=>item.AddPerson(item.PersonName))">Add</MudButton>
                   
                </MudForm>
                <MudText Typo="Typo.body2">The quick, brown fox jumps over a lazy dog.</MudText>
                <MudStack Row="true">
                    <MudDataGrid Items="@item.DbContext.Persons" @bind-SelectedItem="@item.SelectedPerson" Hover="true" Striped="true"  Dense="true" MultiSelection="false">
                        <Columns>
                            <PropertyColumn Property="x => x.FirstName" Title="First Name" />
                            <PropertyColumn Property="x => x.LastName" Title="Last Name" />
                        </Columns>
                    </MudDataGrid>
                    <MudDataGrid Items="@item.PhoneNumbers" Hover="true" Striped="true" Dense="true" MultiSelection="false">
                        <Columns>
                            <PropertyColumn Property="x => x.Number" Title="Number" />
                        </Columns>
                    </MudDataGrid>
               </MudStack>
            </MudCardContent>
            <MudCardActions>
                <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined">
                    <MudButton StartIcon="@Icons.Material.Filled.ArrowUpward" OnClick="@(()=>item.Push())">Push Deltas</MudButton>
                    <MudButton  StartIcon="@Icons.Material.Filled.ArrowDownward" OnClick="@(()=>item.Pull())">Pull Deltas</MudButton>
                    <MudButton  StartIcon="@Icons.Material.Filled.Preview" OnClick="@(()=>item.Pull())">Preview Deltas</MudButton>
                    <MudButton StartIcon="@Icons.Material.Filled.SaveAlt" OnClick="@(()=>item.DownloadFile())">Download Databases</MudButton>
                </MudButtonGroup>
            
            </MudCardActions>
        </MudCard>
    }
 
</MudStack>


